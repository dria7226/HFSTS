head_index += (++granularity_counter == head_granularity);
head_index *= (head_capacity > head_index);
